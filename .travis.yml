language: go
dist: xenial

go:
- '1.9'
- 1.x
- master

before_install:
- sudo apt-get install -y rpm build-essential debhelper dh-make fakeroot

script:
- go get -v -u ./...
- go test -v ./...

before_deploy:
- chmod +x build_tarballs.sh && ./build_tarballs.sh
- make -C rpm/
- dpkg-buildpackage -rfakeroot -uc -us && mv ../*.deb release

deploy:
  provider: releases
  api_key:
    secure: EobqX/LNS3zMPdP7oMFrdiOFV6jDtO9RvPs+8lP0Qcu9e6PQ2kqSvm1iFNVHBnEPWDC5ubPbk2W2qfeSWwPyYm0G4JrQ7yq//IXkLyCmElCNKLXiZKxRQz8mea3avpwMijMJLwHacjZZE0Zn+mFfWsYlJIDp4/c/vGAPrF9rRObaovLGn0lo4aKjUzS9XGOGZAs/o+EM6H+MsTmaHyPvbDrx0qZMWM2dY12T2kkq1BDzGWuWzc0I7+pyLSAtZy3Rho4ExvgEM17qx+ecTQXIc+tgUqZSKgEy9PSAUAhIosat3aRLAY3gteV6U+LZ84LPpk+DJo2qIbD6LTeTUL7rxFqyAuDab7EaX5n6KmCzUTRtUM+6SKKjHG6W3dz1ISTudFtJeI+1+/V1HBGGqFyXRUIoViEJ0vwugdsZvl8EIrbFYuJ4brlQxbYwHMtBuAcO3CTTHgChzJeQqvDCTwNVfI0zC/iGmrn1Nb4LCCsjoPU7xRX2UKDJ9FpAKF+IVkc0TOTh6bIbFg38aRqO4lYZZMrQs6w9CcMumxdSZGBc3VoHoj5EwrtBxRFDqiIbtA263vBdVrRwMVD6at+2toqDedtqav5/+nVRqoFH+jI6vJZAIS3cwcvNbtHWMotBVPeNxg5SDhyTLSmM8SYb6DaucVioMYCzG5g4k/bfr8HuLEA=
  file_glob: true
  file: release/**/*
  skip_cleanup: true
  on:
    tags: true
